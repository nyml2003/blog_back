"use strict";(globalThis["webpackChunkventus"]=globalThis["webpackChunkventus"]||[]).push([[3855],{9724:(e,a,l)=>{l.d(a,{Z:()=>h});var t=l(6929),r=l(7218),o=l(8455),u=l(7493),s=l(1944),n=l(9482);const d={class:"justify-center flex-center flex"},i={__name:"ChangePassword",props:{isOpen:Boolean,close:Function},setup(e){const a=e,l=(0,s.Z)(),i=((0,u.r)(),(0,o.tv)(),(0,r.iH)({old_password:"",new_password:"",confirm_password:""})),m=(0,r.iH)(!1),c=(0,r.iH)(!1);(0,t.YP)(i.value,(()=>{m.value=i.value.new_password===i.value.old_password,c.value=i.value.new_password!==i.value.confirm_password}));const p=()=>{n.userApi.post("/user/change_password/",i.value).then((e=>{console.log(e),e.data.hasOwnProperty("error")?l.notify({message:e.data.error,color:"negative",icon:"report_problem",position:"top",timeout:2e3}):(l.notify({message:e.data.message,color:"positive",icon:"check",position:"top",timeout:2e3}),a.close())})).catch((e=>{l.notify({message:e.toString(),color:"negative",icon:"report_problem",position:"top",timeout:2e3})}))};return(e,l)=>{const r=(0,t.up)("q-input"),o=(0,t.up)("q-btn"),u=(0,t.up)("q-form"),s=(0,t.up)("q-card-section"),n=(0,t.up)("q-card");return(0,t.wg)(),(0,t.j4)(n,{class:"q-ma-md",style:{"min-width":"400px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:i.value.old_password,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.old_password=e),error:m.value,"error-message":m.value?"新旧密码不能相同":"",filled:"",label:"旧密码",type:"password"},null,8,["modelValue","error","error-message"]),(0,t.Wm)(r,{modelValue:i.value.new_password,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.new_password=e),error:m.value,"error-message":m.value?"新旧密码不能相同":"",filled:"",label:"新密码",type:"password"},null,8,["modelValue","error","error-message"]),(0,t.Wm)(r,{modelValue:i.value.confirm_password,"onUpdate:modelValue":l[2]||(l[2]=e=>i.value.confirm_password=e),error:c.value,"error-message":c.value?"两次密码不一致":"",filled:"",label:"确认密码",type:"password"},null,8,["modelValue","error","error-message"]),(0,t._)("div",d,[(0,t.Wm)(o,{class:"q-ma-md",color:"red",label:"取消",type:"submit",onClick:a.close},null,8,["onClick"]),(0,t.Wm)(o,{class:"q-ma-md",color:"primary",label:"修改密码",type:"submit",onClick:p})])])),_:1})])),_:1})])),_:1})}}};var m=l(6786),c=l(7392),p=l(7537),v=l(9033),_=l(5779),w=l(9332),f=l.n(w);const g=i,h=g;f()(i,"components",{QCard:m.Z,QCardSection:c.Z,QForm:p.Z,QInput:v.Z,QBtn:_.Z})},9766:(e,a,l)=>{l.d(a,{Z:()=>y});var t=l(6929),r=l(7218),o=l(9482);l(7531);function u(e,a){return JSON.stringify(e)===JSON.stringify(a)}const s=(0,t._)("div",{class:"text-h6"},"个人信息",-1),n=["src"],d={__name:"ProfileDetail",props:{isOpen:Boolean,close:Function},setup(e){const a=e,l=()=>{o.userApi.get("/user/self/").then((e=>{d.value.nickname=e.data.nickname,d.value.email=e.data.email,d.value.avatar=e.data.avatar,i.value.avatar=e.data.avatar,i.value.id=e.data.id,i.value.created_at=new Date(e.data.created_at).toLocaleString("zh-CN",{hour12:!1}),i.value.updated_at=new Date(e.data.updated_at).toLocaleString("zh-CN",{hour12:!1}),d.value.description=e.data.description,d.value.telephone=e.data.telephone,i.value.username=e.data.username,m.value=JSON.parse(JSON.stringify(d.value))})).catch((e=>{console.log(e)}))},d=(0,r.iH)({nickname:"",email:"",avatar:null,description:"",telephone:null}),i=(0,r.iH)({id:0,created_at:Date(),updated_at:Date(),username:"",avatar:null}),m=(0,r.iH)({});(0,t.bv)((()=>{l()}));const c=()=>{d.value.avatar===m.value.avatar&&delete d.value.avatar,Object.entries(d.value).forEach((([e,a])=>{""!==a&&null!==a&&void 0!==a||delete d.value[e]})),o.userApi.patch("/user/self/",d.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{l(),a.close()})).catch((e=>{console.log(e)}))},p=(0,r.iH)(!1);return(0,t.YP)(d.value,(()=>{p.value=!(d.value.email||d.value.telephone)})),(e,l)=>{const o=(0,t.up)("q-card-section"),v=(0,t.up)("q-icon"),_=(0,t.up)("q-input"),w=(0,t.up)("q-avatar"),f=(0,t.up)("q-file"),g=(0,t.up)("q-btn"),h=(0,t.up)("q-card-actions"),b=(0,t.up)("q-form"),W=(0,t.up)("q-card");return(0,t.wg)(),(0,t.j4)(W,{class:"q-ma-md",style:{"max-width":"400px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{class:"q-pa-md"},{default:(0,t.w5)((()=>[s])),_:1}),(0,t.Wm)(b,{class:"q-ma-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{modelValue:d.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value.nickname=e),label:"昵称","lazy-rules":"",clearable:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"account_circle"})])),_:1},8,["modelValue"]),(0,t.Wm)(_,{modelValue:d.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>d.value.email=e),label:"邮箱","lazy-rules":"",rules:[e=>!e||/.+@.+/.test(e)||"请输入正确的邮箱"],clearable:"",error:p.value,"error-message":p.value?"手机号和邮箱至少填写一项":""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"email"})])),_:1},8,["modelValue","rules","error","error-message"]),(0,t.Wm)(_,{modelValue:d.value.telephone,"onUpdate:modelValue":l[2]||(l[2]=e=>d.value.telephone=e),label:"电话","lazy-rules":"",rules:[e=>!e||11===e.length&&/^\d+$/.test(e)||"请输入正确的电话号码"],error:p.value,clearable:"","error-message":p.value?"手机号和邮箱至少填写一项":""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"phone"})])),_:1},8,["modelValue","rules","error","error-message"]),(0,t.Wm)(_,{modelValue:d.value.description,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value.description=e),label:"个人简介","lazy-rules":"",clearable:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"description"})])),_:1},8,["modelValue"]),(0,t.Wm)(_,{modelValue:i.value.username,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.username=e),label:"用户名",readonly:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"account_circle"})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{modelValue:d.value.avatar,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value.avatar=e),label:"头像","lazy-rules":"",clearable:"",onClear:l[6]||(l[6]=e=>d.value.avatar=i.value.avatar),accept:"image/*",rules:[e=>!e||!e.size||e.size<2097152||"文件大小不能超过2MB"]},{before:(0,t.w5)((()=>[d.value.avatar?((0,t.wg)(),(0,t.j4)(w,{key:0},{default:(0,t.w5)((()=>[(0,t._)("img",{src:d.value.avatar},null,8,n)])),_:1})):((0,t.wg)(),(0,t.j4)(v,{key:1,name:"avatar"}))])),_:1},8,["modelValue","rules"]),(0,t.Wm)(_,{modelValue:i.value.created_at,"onUpdate:modelValue":l[7]||(l[7]=e=>i.value.created_at=e),label:"创建时间",readonly:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"calendar_today"})])),_:1},8,["modelValue"]),(0,t.Wm)(_,{modelValue:i.value.updated_at,"onUpdate:modelValue":l[8]||(l[8]=e=>i.value.updated_at=e),label:"更新时间",readonly:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"calendar_today"})])),_:1},8,["modelValue"]),(0,t.Wm)(h,{align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{flat:"",label:"取消",onClick:a.close},null,8,["onClick"]),(0,t.Wm)(g,{flat:"",label:"保存",color:"primary",type:"submit",disable:(0,r.SU)(u)(d.value,m.value),onClick:c},null,8,["disable"])])),_:1})])),_:1})])),_:1})}}};var i=l(6786),m=l(7392),c=l(7537),p=l(9033),v=l(1909),_=l(8545),w=l(4743),f=l(1789),g=l(5779),h=l(9332),b=l.n(h);const W=d,y=W;b()(d,"components",{QCard:i.Z,QCardSection:m.Z,QForm:c.Z,QInput:p.Z,QIcon:v.Z,QFile:_.Z,QAvatar:w.Z,QCardActions:f.Z,QBtn:g.Z})},3855:(e,a,l)=>{l.r(a),l.d(a,{default:()=>H});l(5954);var t=l(6929),r=l(80),o=l(9482),u=l(7218),s=l(8455),n=l(9766),d=l(9724),i=l(1944);const m={class:"row"},c={class:"col text-right text-caption text-white"},p=["src"],v={class:"q-ma-md text-h5 text-weight-bolder text-right"},_={class:"text-subtitle2 q-my-md"},w={class:"row"},f={class:"row"},g={class:"row"},h={__name:"ProfileMobileInfo",setup(e){(0,i.Z)(),(0,s.tv)(),(0,u.iH)(["温馨提示，邮箱、电话、用户唯一标识均可用于登录",""]);const a=(0,u.iH)([{name:"评论总数",value:0,field:"comment_count"},{name:"发送敏感请求总数",value:0,field:"request_count"}]),l=()=>{o.userApi.get("/user/self/").then((e=>{b.value.nickname=e.data.nickname,b.value.email=e.data.email,b.value.avatar=e.data.avatar,b.value.id=e.data.id,b.value.created_at=new Date(e.data.created_at).toLocaleString("zh-CN",{hour12:!1}),b.value.description=e.data.description,b.value.telephone=e.data.telephone,b.value.username=e.data.username})).catch((e=>{console.log(e)})),o.userApi.get("/comment/user/").then((e=>{h.value=e.data,h.value.forEach((e=>{e.updated_at=new Date(e.updated_at).toLocaleString("zh-CN",{hour12:!1})})),h.value.forEach((e=>{e.isUpdate=!1}))})),o.userApi.get("/user/statistics/comment/").then((e=>{a.value[0].value=e.data.count})),o.userApi.get("/user/statistics/database_request/").then((e=>{a.value[1].value=e.data.count}))},h=(0,u.iH)([]);(0,t.bv)((()=>{l()}));const b=(0,u.iH)({id:0,nickname:"",email:"",avatar:null,description:"",telephone:null,username:"",created_at:""}),W=(0,u.iH)(!1),y=(0,u.iH)(!1);return(e,a)=>{const o=(0,t.up)("q-dialog"),u=(0,t.up)("q-icon"),s=(0,t.up)("q-card-section"),i=(0,t.up)("q-avatar"),h=(0,t.up)("q-separator"),V=(0,t.up)("q-btn"),q=(0,t.up)("q-card-actions"),Z=(0,t.up)("q-card"),k=(0,t.up)("q-page");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(o,{modelValue:W.value,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value=e),persistent:"","full-height":""},{default:(0,t.w5)((()=>[(0,t.Wm)(n.Z,{isOpen:W.value,close:()=>{W.value=!1,l()}},null,8,["isOpen","close"])])),_:1},8,["modelValue"]),(0,t.Wm)(o,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),persistent:""},{default:(0,t.w5)((()=>[(0,t.Wm)(d.Z,{isOpen:y.value,close:()=>{y.value=!1,l()}},null,8,["isOpen","close"])])),_:1},8,["modelValue"]),(0,t.Wm)(k,{class:"flex items-start content-start justify-center"},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"q-mx-md q-mt-md q-mb-sm",style:{width:"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{tag:"div",style:{height:"132px"},class:"bg-grey"},{default:(0,t.w5)((()=>[(0,t._)("div",m,[(0,t._)("div",c,[(0,t.Wm)(u,{name:"calendar_today"}),(0,t.Uk)(" 温馨提示，邮箱、电话、用户唯一标识均可用于登录 ")])])])),_:1}),(0,t.Wm)(i,{class:"absolute-center",size:"120px",style:{left:"25%","border-radius":"50%",top:"calc(132px)"}},{default:(0,t.w5)((()=>[(0,t._)("img",{src:b.value.avatar},null,8,p)])),_:1}),(0,t._)("div",v,(0,r.zw)(b.value.nickname),1),(0,t.Wm)(h),(0,t.Wm)(s,{tag:"div",style:{height:"calc(100vh - 350px)","overflow-y":"auto"}},{default:(0,t.w5)((()=>[(0,t._)("div",_,(0,r.zw)(b.value.description),1),(0,t._)("div",w,[(0,t.Wm)(u,{name:"email"}),(0,t.Uk)(" 邮箱: "+(0,r.zw)(b.value.email),1)]),(0,t._)("div",f,[(0,t.Wm)(u,{name:"phone"}),(0,t.Uk)(" 电话: "+(0,r.zw)(b.value.telephone),1)]),(0,t._)("div",g,[(0,t.Wm)(u,{name:"description"}),(0,t.Uk)(" 用户唯一标识: "+(0,r.zw)(b.value.username),1)])])),_:1}),(0,t.Wm)(q,{align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{flat:"",label:"修改密码",color:"red",onClick:a[2]||(a[2]=e=>y.value=!0)}),(0,t.Wm)(V,{flat:"",label:"编辑个人资料",color:"primary",onClick:a[3]||(a[3]=e=>W.value=!0)})])),_:1})])),_:1})])),_:1})],64)}}};var b=l(128),W=l(7959),y=l(6786),V=l(7392),q=l(1909),Z=l(4743),k=l(4348),C=l(1789),Q=l(5779),x=l(9332),U=l.n(x);const z=h,H=z;U()(h,"components",{QDialog:b.Z,QPage:W.Z,QCard:y.Z,QCardSection:V.Z,QIcon:q.Z,QAvatar:Z.Z,QSeparator:k.Z,QCardActions:C.Z,QBtn:Q.Z})}}]);