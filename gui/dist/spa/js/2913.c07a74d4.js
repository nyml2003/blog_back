"use strict";(globalThis["webpackChunkventus"]=globalThis["webpackChunkventus"]||[]).push([[2913],{6758:(e,a,l)=>{l.d(a,{Z:()=>u});var t=l(6929),n=l(859),o=l(4429),r=l(8192);const u=(0,n.L)({name:"QList",props:{...o.S,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:a}){const l=(0,t.FN)(),n=(0,o.Z)(e,l.proxy.$q),u=(0,t.Fl)((()=>"q-list"+(!0===e.bordered?" q-list--bordered":"")+(!0===e.dense?" q-list--dense":"")+(!0===e.separator?" q-list--separator":"")+(!0===n.value?" q-list--dark":"")+(!0===e.padding?" q-list--padding":"")));return()=>(0,t.h)(e.tag,{class:u.value},(0,r.KR)(a.default))}})},4348:(e,a,l)=>{l.d(a,{Z:()=>i});var t=l(6929),n=l(4429),o=l(859);const r={true:"inset",item:"item-inset","item-thumbnail":"item-thumbnail-inset"},u={xs:2,sm:4,md:8,lg:16,xl:24},i=(0,o.L)({name:"QSeparator",props:{...n.S,spaced:[Boolean,String],inset:[Boolean,String],vertical:Boolean,color:String,size:String},setup(e){const a=(0,t.FN)(),l=(0,n.Z)(e,a.proxy.$q),o=(0,t.Fl)((()=>!0===e.vertical?"vertical":"horizontal")),i=(0,t.Fl)((()=>` q-separator--${o.value}`)),s=(0,t.Fl)((()=>!1!==e.inset?`${i.value}-${r[e.inset]}`:"")),d=(0,t.Fl)((()=>`q-separator${i.value}${s.value}`+(void 0!==e.color?` bg-${e.color}`:"")+(!0===l.value?" q-separator--dark":""))),c=(0,t.Fl)((()=>{const a={};if(void 0!==e.size&&(a[!0===e.vertical?"width":"height"]=e.size),!1!==e.spaced){const l=!0===e.spaced?`${u.md}px`:e.spaced in u?`${u[e.spaced]}px`:e.spaced,t=!0===e.vertical?["Left","Right"]:["Top","Bottom"];a[`margin${t[0]}`]=a[`margin${t[1]}`]=l}return a}));return()=>(0,t.h)("hr",{class:d.value,style:c.value,"aria-orientation":o.value})}})},1944:(e,a,l)=>{l.d(a,{Z:()=>o});var t=l(6929),n=l(7623);function o(){return(0,t.f3)(n.Ng)}},7513:(e,a,l)=>{l.d(a,{D:()=>t});l(7531);function t(e,a){return JSON.stringify(e)===JSON.stringify(a)}},2913:(e,a,l)=>{l.r(a),l.d(a,{default:()=>R});l(5954);var t=l(6929),n=l(80),o=l(9482),r=l(7218),u=l(8455),i=l(7513);const s=(0,t._)("div",{class:"text-h6"},"个人信息",-1),d=["src"],c={__name:"ProfileDetail",props:{isOpen:Boolean,close:Function},setup(e){const a=e,l=()=>{o.userApi.get("/user/self/").then((e=>{n.value.nickname=e.data.nickname,n.value.email=e.data.email,n.value.avatar=e.data.avatar,u.value.avatar=e.data.avatar,u.value.id=e.data.id,u.value.created_at=new Date(e.data.created_at).toLocaleString("zh-CN",{hour12:!1}),u.value.updated_at=new Date(e.data.updated_at).toLocaleString("zh-CN",{hour12:!1}),n.value.description=e.data.description,n.value.telephone=e.data.telephone,u.value.username=e.data.username,c.value=JSON.parse(JSON.stringify(n.value))})).catch((e=>{console.log(e)}))},n=(0,r.iH)({nickname:"",email:"",avatar:null,description:"",telephone:null}),u=(0,r.iH)({id:0,created_at:Date(),updated_at:Date(),username:"",avatar:null}),c=(0,r.iH)({});(0,t.bv)((()=>{l()}));const m=()=>{n.value.avatar===c.value.avatar&&delete n.value.avatar,Object.entries(n.value).forEach((([e,a])=>{""!==a&&null!==a&&void 0!==a||delete n.value[e]})),o.userApi.patch("/user/self/",n.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{l(),a.close()})).catch((e=>{console.log(e)}))},p=(0,r.iH)(!1);return(0,t.YP)(n.value,(()=>{p.value=!(n.value.email||n.value.telephone)})),(e,l)=>{const o=(0,t.up)("q-card-section"),v=(0,t.up)("q-icon"),g=(0,t.up)("q-input"),h=(0,t.up)("q-avatar"),_=(0,t.up)("q-file"),w=(0,t.up)("q-btn"),f=(0,t.up)("q-card-actions"),b=(0,t.up)("q-form"),y=(0,t.up)("q-card");return(0,t.wg)(),(0,t.j4)(y,{class:"q-ma-md",style:{"max-width":"400px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{class:"q-pa-md"},{default:(0,t.w5)((()=>[s])),_:1}),(0,t.Wm)(b,{class:"q-ma-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{modelValue:n.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=e=>n.value.nickname=e),label:"昵称","lazy-rules":"",clearable:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"account_circle"})])),_:1},8,["modelValue"]),(0,t.Wm)(g,{modelValue:n.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value.email=e),label:"邮箱","lazy-rules":"",rules:[e=>!e||/.+@.+/.test(e)||"请输入正确的邮箱"],clearable:"",error:p.value,"error-message":p.value?"手机号和邮箱至少填写一项":""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"email"})])),_:1},8,["modelValue","rules","error","error-message"]),(0,t.Wm)(g,{modelValue:n.value.telephone,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value.telephone=e),label:"电话","lazy-rules":"",rules:[e=>!e||11===e.length&&/^\d+$/.test(e)||"请输入正确的电话号码"],error:p.value,clearable:"","error-message":p.value?"手机号和邮箱至少填写一项":""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"phone"})])),_:1},8,["modelValue","rules","error","error-message"]),(0,t.Wm)(g,{modelValue:n.value.description,"onUpdate:modelValue":l[3]||(l[3]=e=>n.value.description=e),label:"个人简介","lazy-rules":"",clearable:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"description"})])),_:1},8,["modelValue"]),(0,t.Wm)(g,{modelValue:u.value.username,"onUpdate:modelValue":l[4]||(l[4]=e=>u.value.username=e),label:"用户名",readonly:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"account_circle"})])),_:1},8,["modelValue"]),(0,t.Wm)(_,{modelValue:n.value.avatar,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.avatar=e),label:"头像","lazy-rules":"",clearable:"",onClear:l[6]||(l[6]=e=>n.value.avatar=u.value.avatar),accept:"image/*",rules:[e=>!e||!e.size||e.size<2097152||"文件大小不能超过2MB"]},{before:(0,t.w5)((()=>[n.value.avatar?((0,t.wg)(),(0,t.j4)(h,{key:0},{default:(0,t.w5)((()=>[(0,t._)("img",{src:n.value.avatar},null,8,d)])),_:1})):((0,t.wg)(),(0,t.j4)(v,{key:1,name:"avatar"}))])),_:1},8,["modelValue","rules"]),(0,t.Wm)(g,{modelValue:u.value.created_at,"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.created_at=e),label:"创建时间",readonly:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"calendar_today"})])),_:1},8,["modelValue"]),(0,t.Wm)(g,{modelValue:u.value.updated_at,"onUpdate:modelValue":l[8]||(l[8]=e=>u.value.updated_at=e),label:"更新时间",readonly:""},{before:(0,t.w5)((()=>[(0,t.Wm)(v,{name:"calendar_today"})])),_:1},8,["modelValue"]),(0,t.Wm)(f,{align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{flat:"",label:"取消",onClick:a.close},null,8,["onClick"]),(0,t.Wm)(w,{flat:"",label:"保存",color:"primary",type:"submit",disable:(0,r.SU)(i.D)(n.value,c.value),onClick:m},null,8,["disable"])])),_:1})])),_:1})])),_:1})}}};var m=l(6786),p=l(7392),v=l(7537),g=l(9033),h=l(1909),_=l(8545),w=l(4743),f=l(1789),b=l(5779),y=l(9332),q=l.n(y);const W=c,k=W;q()(c,"components",{QCard:m.Z,QCardSection:p.Z,QForm:v.Z,QInput:g.Z,QIcon:h.Z,QFile:_.Z,QAvatar:w.Z,QCardActions:f.Z,QBtn:b.Z});var x=l(1944);const V={style:{position:"absolute",left:"20%",top:"10%"}},Z={class:"text-h5 text-weight-bolder"},C={class:"text-subtitle2 q-my-md"},z={class:"row",style:{width:"800px"}},Q={class:"col"},U={class:"col"},S={class:"col"},D={class:"row"},$={class:"col text-right text-caption text-grey"},B=["src"],A={class:"q-mx-md q-mb-md row",style:{"min-width":"1000px","min-height":"500px"}},H={class:"row justify-between flex-center"},F=["onClick"],N={class:"text-subtitle2 text-grey"},j={class:"text-h6 text-weight-bold"},L={class:"text-subtitle2 text-grey"},O={__name:"ProfilePageDesktop",setup(e){const a=(0,x.Z)(),l=(0,u.tv)(),i=((0,r.iH)(["温馨提示，邮箱、电话、用户唯一标识均可用于登录",""]),(0,r.iH)([{name:"评论总数",value:0,field:"comment_count"},{name:"发送敏感请求总数",value:0,field:"request_count"}])),s=()=>{o.userApi.get("/user/self/").then((e=>{c.value.nickname=e.data.nickname,c.value.email=e.data.email,c.value.avatar=e.data.avatar,c.value.id=e.data.id,c.value.created_at=new Date(e.data.created_at).toLocaleString("zh-CN",{hour12:!1}),c.value.description=e.data.description,c.value.telephone=e.data.telephone,c.value.username=e.data.username})).catch((e=>{console.log(e)})),o.userApi.get("/comment/user/").then((e=>{d.value=e.data,d.value.forEach((e=>{e.updated_at=new Date(e.updated_at).toLocaleString("zh-CN",{hour12:!1})})),d.value.forEach((e=>{e.isUpdate=!1}))})),o.userApi.get("/user/statistics/comment/").then((e=>{i.value[0].value=e.data.count})),o.userApi.get("/user/statistics/database_request/").then((e=>{i.value[1].value=e.data.count}))},d=(0,r.iH)([]);(0,t.bv)((()=>{s()}));const c=(0,r.iH)({id:0,nickname:"",email:"",avatar:null,description:"",telephone:null,username:"",created_at:""}),m=e=>{l.push({name:"BlogDetail",params:{id:e}})},p=(e,a)=>{o.userApi.patch(`/comment/rest/${e}/`,{content:a}).then((a=>{d.value[d.value.findIndex((a=>a.id===e))].isUpdate=!1,s()}))},v=e=>{a.notify({message:"确定删除该评论吗？",color:"negative",position:"center",icon:"delete",timeout:2e3,actions:[{label:"确定",color:"white",handler:()=>{o.userApi.delete(`/comment/rest/${e.id}/`).then((e=>{a.notify({message:"删除成功",color:"positive",position:"top",icon:"delete",timeout:2e3}),s()}))}},{label:"取消",color:"white",handler:()=>{}}]})},g=(0,r.iH)(!1);return(e,a)=>{const l=(0,t.up)("q-dialog"),o=(0,t.up)("q-card-section"),r=(0,t.up)("q-separator"),u=(0,t.up)("q-icon"),h=(0,t.up)("q-avatar"),_=(0,t.up)("q-btn"),w=(0,t.up)("q-card-actions"),f=(0,t.up)("q-card"),b=(0,t.up)("q-input"),y=(0,t.up)("q-item-section"),q=(0,t.up)("q-item"),W=(0,t.up)("q-list"),x=(0,t.up)("q-page");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(l,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),persistent:""},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{isOpen:g.value,close:()=>{g.value=!1,s()}},null,8,["isOpen","close"])])),_:1},8,["modelValue"]),(0,t.Wm)(x,{class:"flex items-start content-start justify-center"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{class:"q-mx-md q-mt-md q-mb-sm",style:{"min-width":"1000px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{tag:"div",style:{height:"132px"},class:"bg-grey"}),(0,t.Wm)(r),(0,t.Wm)(o,{tag:"div",style:{height:"132px"}},{default:(0,t.w5)((()=>[(0,t._)("div",V,[(0,t._)("div",Z,(0,n.zw)(c.value.nickname),1),(0,t._)("div",C,(0,n.zw)(c.value.description),1),(0,t._)("div",z,[(0,t._)("div",Q,[(0,t.Wm)(u,{name:"email"}),(0,t.Uk)(" 邮箱: "+(0,n.zw)(c.value.email),1)]),(0,t._)("div",U,[(0,t.Wm)(u,{name:"phone"}),(0,t.Uk)(" 电话: "+(0,n.zw)(c.value.telephone),1)]),(0,t._)("div",S,[(0,t.Wm)(u,{name:"description"}),(0,t.Uk)(" 用户唯一标识: "+(0,n.zw)(c.value.username),1)])])]),(0,t._)("div",D,[(0,t._)("div",$,[(0,t.Wm)(u,{name:"calendar_today"}),(0,t.Uk)(" 温馨提示，邮箱、电话、用户唯一标识均可用于登录 ")])])])),_:1}),(0,t.Wm)(h,{class:"absolute-center",size:"160px",style:{left:"10%","border-radius":"50%"}},{default:(0,t.w5)((()=>[(0,t._)("img",{src:c.value.avatar},null,8,B)])),_:1}),(0,t.Wm)(w,{align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{flat:"",label:"编辑个人资料",color:"primary",onClick:a[1]||(a[1]=e=>g.value=!0)})])),_:1})])),_:1}),(0,t._)("div",A,[(0,t.Wm)(f,{class:"q-mr-xs col"},{default:(0,t.w5)((()=>[(0,t.Wm)(W,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(d.value,(e=>((0,t.wg)(),(0,t.j4)(q,{key:e.id,class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[(0,t._)("div",H,[(0,t._)("div",{class:"text-h6",onClick:a=>m(e.parent_id)}," 对《 "+(0,n.zw)(e.parent_name)+" 》的评论 ",9,F),(0,t._)("div",N,[(0,t.Wm)(_,{flat:"",dense:"",round:"",onClick:a=>v(e),icon:"delete",color:"negative"},null,8,["onClick"]),(0,t.Uk)(" 发布时间:"+(0,n.zw)(e.updated_at),1)])]),(0,t.Wm)(r),(0,t.Wm)(b,{type:"textarea",readonly:!e.isUpdate,modelValue:e.content,"onUpdate:modelValue":a=>e.content=a,autogrow:""},{append:(0,t.w5)((()=>[e.isUpdate?((0,t.wg)(),(0,t.j4)(_,{key:1,flat:"",dense:"",round:"",onClick:a=>p(e.id,e.content),icon:"save",color:"positive"},null,8,["onClick"])):((0,t.wg)(),(0,t.j4)(_,{key:0,flat:"",dense:"",round:"",onClick:a=>e.isUpdate=!e.isUpdate,class:"q-mr-xs",color:"primary",icon:"edit"},null,8,["onClick"]))])),_:2},1032,["readonly","modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,t.Wm)(f,{class:"col-3"},{default:(0,t.w5)((()=>[(0,t.Wm)(W,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.value,(e=>((0,t.wg)(),(0,t.j4)(q,{key:e.name},{default:(0,t.w5)((()=>[(0,t.Wm)(y,null,{default:(0,t.w5)((()=>[(0,t._)("div",j,(0,n.zw)(e.name),1),(0,t._)("div",L,(0,n.zw)(e.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])])),_:1})],64)}}};var I=l(128),P=l(7959),J=l(4348),T=l(6758),Y=l(3251),E=l(9131);const K=O,R=K;q()(O,"components",{QDialog:I.Z,QPage:P.Z,QCard:m.Z,QCardSection:p.Z,QSeparator:J.Z,QIcon:h.Z,QAvatar:w.Z,QCardActions:f.Z,QBtn:b.Z,QList:T.Z,QItem:Y.Z,QItemSection:E.Z,QInput:g.Z})}}]);