"use strict";(globalThis["webpackChunkventus"]=globalThis["webpackChunkventus"]||[]).push([[8729],{8729:(e,t,a)=>{a.r(t),a.d(t,{default:()=>V});a(5954);var l=a(6929),o=a(7218),n=a(9482),u=a(9487),s=a(8455),i=a(1944),d=(a(355),a(7911));const p=(0,l._)("div",{class:"text-h6"},"正文",-1),r={__name:"BlogEdit",setup(e){const t=(0,i.Z)(),a=(0,s.yj)(),r=(0,s.tv)(),c=(0,o.iH)(0),m=(0,o.iH)(""),v=(0,o.iH)({title:"",description:"",tags:[]}),g=(0,o.iH)([]),h=()=>{a.query.id&&(c.value=parseInt(a.query.id),n.userApi.get("/blog/rest/"+c.value+"/").then((e=>{v.value.title=e.data.title,v.value.description=e.data.description;const t=e.data.content;d.Z.get(t).then((e=>{m.value=e.data.toString()})),v.value.tags=e.data.tags.map((e=>e.id))}))),n.userApi.get("/tag/rest/").then((e=>{g.value=e.data.map((e=>({label:e.name,value:e.id})))}))};(0,l.bv)((()=>{h()}));const b=()=>{n.userApi.post("/blog/rest/",v.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{t.notify({message:"添加成功",color:"positive",icon:"check",position:"top",timeout:1e3}),console.log(e),r.push({path:"/admin/manage/blog/edit",query:{id:e.data.id}}),c.value=e.data.id,h()})).catch((e=>{console.log(e),h()}))},f=()=>{n.userApi.patch("/blog/rest/"+c.value+"/",v.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{t.notify({message:"修改成功",color:"positive",icon:"check",position:"top",timeout:1e3}),h()})).catch((e=>{console.log(e),h()}))},w=async(e,t)=>{const a=await Promise.all(e.map((e=>new Promise(((t,a)=>{const l=new FormData;l.append("file",e),n.userApi.post("/img/upload/",l,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>t(e))).catch((e=>a(e)))})))));t(a.map((e=>`${n.baseMediaURL}${e.data.url}`)))},y=()=>{v.value.content=new File([m.value],"content.md",{type:"text/plain;charset=utf-8"}),0===c.value?b():f()};return(e,t)=>{const a=(0,l.up)("q-icon"),n=(0,l.up)("q-input"),s=(0,l.up)("q-card-section"),i=(0,l.up)("q-separator"),d=(0,l.up)("q-select"),r=(0,l.up)("q-card"),c=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(c,{class:"flex flex-center"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"q-pa-md q-ma-lg",style:{width:"80vw"}},{default:(0,l.w5)((()=>[(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[(0,l.Wm)(n,{modelValue:v.value.title,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value.title=e),dense:"",outlined:"",type:"text",class:"headline"},{prepend:(0,l.w5)((()=>[(0,l.Wm)(a,{name:"title"})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(i),(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[(0,l.Wm)(n,{modelValue:v.value.description,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value.description=e),dense:"",outlined:"",type:"textarea",class:"subtitle-2",label:"摘要"},null,8,["modelValue"]),(0,l.Wm)(d,{modelValue:v.value.tags,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value.tags=e),label:"标签",dense:"","lazy-rules":"",options:g.value,multiple:"","use-chips":"","map-options":"","emit-value":"","input-debounce":"0",rules:[e=>!!e||"请选择标签",e=>e.length>0||"至少选择一项"]},null,8,["modelValue","options","rules"])])),_:1}),(0,l.Wm)(i),(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[p,(0,l.Wm)((0,o.SU)(u.Z),{modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),onUploadImg:w,onSave:y},null,8,["modelValue"])])),_:1}),(0,l.Wm)(i)])),_:1})])),_:1})}}};var c=a(7959),m=a(6786),v=a(7392),g=a(9033),h=a(1909),b=a(4348),f=a(7463),w=a(9332),y=a.n(w);const q=r,V=q;y()(r,"components",{QPage:c.Z,QCard:m.Z,QCardSection:v.Z,QInput:g.Z,QIcon:h.Z,QSeparator:b.Z,QSelect:f.Z})}}]);