"use strict";(globalThis["webpackChunkventus"]=globalThis["webpackChunkventus"]||[]).push([[7480],{7480:(e,a,l)=>{l.r(a),l.d(a,{default:()=>q});var o=l(6929),n=l(80),t=l(1944),i=l(7218),r=l(9482);const u=["src"],s=["src"],m=["href"],c={__name:"FriendManage",setup(e){const a=(0,t.Z)(),l=(0,i.iH)([]),c=(0,i.iH)(!1),d=()=>{c.value=!0,console.log(p.pagination.value),r.userApi.get("/friend/rest/",{params:{page:p.pagination.value.page,page_size:p.pagination.value.rowsPerPage}}).then((e=>{l.value=e.data.results,p.pagination.value.rowsNumber=e.data.count})),c.value=!1},p={loading:(0,i.iH)(!1),columns:[{name:"id",label:"ID",field:"id",align:"center"},{name:"nickname",label:"昵称",field:"nickname",align:"center"},{name:"avatar",label:"头像",field:"avatar",align:"center"},{name:"description",label:"个人简介",field:"description",align:"center"},{name:"url",label:"个人主页",field:"url",align:"center"},{name:"created_at",label:"创建时间",field:"created_at",format:e=>new Date(e).toLocaleString(),align:"center"},{name:"updated_at",label:"更新时间",field:"updated_at",format:e=>new Date(e).toLocaleString(),align:"center"},{name:"operation",label:"操作",field:"operation",align:"center"}],pagination:(0,i.iH)({sortBy:"id",descending:!1,page:1,rowsNumber:0,rowsPerPage:7}),onRequest:function(e){const{page:a,rowsPerPage:l}=e.pagination;p.pagination.value.page=a,p.pagination.value.rowsPerPage=l,d()}},f={canCreate:function(){return JSON.stringify(f.form.value)===JSON.stringify(f.nullForm)},nullForm:{nickname:"",avatar:null,description:"",url:""},form:(0,i.iH)({nickname:"",avatar:null,description:"",url:""}),isVisible:(0,i.iH)(!1),reset:function(){f.form.value=JSON.parse(JSON.stringify(f.nullForm))},submit:function(){r.userApi.post("/friend/rest/",f.form.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{a.notify({message:"添加成功",color:"positive",icon:"check",position:"top",timeout:1e3}),f.reset(),f.close(),d()})).catch((e=>{a.notify({message:`添加失败,原因:${e.response.data.name}`,color:"negative",icon:"close",position:"top",timeout:1e3}),f.reset(),f.close()}))},open:function(){this.isVisible.value=!0},close:function(){this.isVisible.value=!1}},v={isImgChange:(0,i.iH)(!1),canUpdate:function(){return JSON.stringify(v.form.value)===JSON.stringify(v.formCopy.value)},avatar:(0,i.iH)(null),formCopy:(0,i.iH)({id:"",nickname:"",avatar:null,description:"",url:""}),form:(0,i.iH)({id:"",nickname:"",avatar:null,description:"",url:""}),isVisible:(0,i.iH)(!1),reset:function(){v.form.value=JSON.parse(JSON.stringify(v.formCopy.value))},submit:function(){r.userApi.patch(`/friend/rest/${v.form.value.id}/`,v.form.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{a.notify({message:"修改成功",color:"positive",icon:"check",position:"top",timeout:1e3}),v.reset(),v.close(),d()})).catch((e=>{a.notify({message:`修改失败,原因:${e.response.data.name}`,color:"negative",icon:"close",position:"top",timeout:1e3}),v.reset(),v.close()}))},open:function(e){this.isVisible.value=!0;const{id:a,nickname:l,avatar:o,description:n,url:t}=e;v.avatar.value=o,v.form.value={id:a,nickname:l,avatar:null,description:n,url:t},v.formCopy.value=JSON.parse(JSON.stringify(v.form.value))},close:function(){this.isVisible.value=!1}};function g(e){a.notify({message:"删除中",color:"warning",textColor:"black",icon:"warning",position:"center",actions:[{label:"取消",color:"black",handler:()=>{a.notify({message:"取消删除",color:"negative",icon:"close",position:"top",timeout:1e3})}},{label:"确定",color:"red",handler:()=>{b(e)}}]})}function b(e){r.userApi.delete(`/friend/rest/${e}/`).then((e=>{a.notify({message:"删除成功",color:"positive",icon:"check",position:"top",timeout:1e3}),d()})).catch((e=>{console.log(e)}))}return(0,o.bv)((()=>{d()})),(e,a)=>{const t=(0,o.up)("q-input"),i=(0,o.up)("q-file"),r=(0,o.up)("q-btn"),c=(0,o.up)("q-card-actions"),d=(0,o.up)("q-form"),b=(0,o.up)("q-card-section"),w=(0,o.up)("q-card"),y=(0,o.up)("q-dialog"),k=(0,o.up)("q-td"),V=(0,o.up)("q-icon"),h=(0,o.up)("q-tr"),_=(0,o.up)("q-table");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(y,{modelValue:v.isVisible.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.isVisible.value=e),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{onSubmit:v.submit,onReset:v.reset},{default:(0,o.w5)((()=>[(0,o.Wm)(t,{modelValue:v.form.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=e=>v.form.value.nickname=e),label:"昵称","lazy-rules":"",rules:[e=>!!e||"请输入昵称"]},null,8,["modelValue","rules"]),(0,o.Wm)(i,{modelValue:v.form.value.avatar,"onUpdate:modelValue":a[1]||(a[1]=e=>v.form.value.avatar=e),label:"头像","lazy-rules":"",multiple:!1,accept:"image/*"},{prepend:(0,o.w5)((()=>[null===v.form.value.avatar?((0,o.wg)(),(0,o.iD)("img",{key:0,src:`${v.avatar.value}`,style:{width:"50px",height:"50px","border-radius":"50%"},alt:"图片加载失败"},null,8,u)):(0,o.kq)("",!0)])),_:1},8,["modelValue"]),(0,o.Wm)(t,{modelValue:v.form.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>v.form.value.description=e),label:"个人简介","lazy-rules":""},null,8,["modelValue"]),(0,o.Wm)(t,{modelValue:v.form.value.url,"onUpdate:modelValue":a[3]||(a[3]=e=>v.form.value.url=e),label:"个人主页","lazy-rules":"",rules:[e=>!!e||"请输入个人主页"]},null,8,["modelValue","rules"]),(0,o.Wm)(c,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{flat:"",dense:"",icon:"close",color:"negative",onClick:a[4]||(a[4]=e=>v.close())},{default:(0,o.w5)((()=>[(0,o.Uk)(" 取消 ")])),_:1}),(0,o.Wm)(r,{flat:"",dense:"",icon:"save",color:"primary",type:"submit",disable:v.canUpdate()},{default:(0,o.w5)((()=>[(0,o.Uk)(" 保存 ")])),_:1},8,["disable"]),(0,o.Wm)(r,{flat:"",dense:"",icon:"refresh",color:"primary",type:"reset"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1},8,["onSubmit","onReset"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(y,{modelValue:f.isVisible.value,"onUpdate:modelValue":a[11]||(a[11]=e=>f.isVisible.value=e),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{onSubmit:f.submit,onReset:f.reset},{default:(0,o.w5)((()=>[(0,o.Wm)(t,{modelValue:f.form.value.nickname,"onUpdate:modelValue":a[6]||(a[6]=e=>f.form.value.nickname=e),label:"昵称","lazy-rules":"",rules:[e=>!!e||"请输入昵称"]},null,8,["modelValue","rules"]),(0,o.Wm)(i,{modelValue:f.form.value.avatar,"onUpdate:modelValue":a[7]||(a[7]=e=>f.form.value.avatar=e),label:"头像","lazy-rules":"",rules:[e=>!!e||"请选择头像"],multiple:!1,accept:"image/*"},null,8,["modelValue","rules"]),(0,o.Wm)(t,{modelValue:f.form.value.description,"onUpdate:modelValue":a[8]||(a[8]=e=>f.form.value.description=e),label:"个人简介","lazy-rules":""},null,8,["modelValue"]),(0,o.Wm)(t,{modelValue:f.form.value.url,"onUpdate:modelValue":a[9]||(a[9]=e=>f.form.value.url=e),label:"个人主页","lazy-rules":"",rules:[e=>!!e||"请输入个人主页"]},null,8,["modelValue","rules"]),(0,o.Wm)(c,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{flat:"",dense:"",icon:"close",color:"negative",onClick:a[10]||(a[10]=e=>f.close())},{default:(0,o.w5)((()=>[(0,o.Uk)(" 取消 ")])),_:1}),(0,o.Wm)(r,{flat:"",dense:"",icon:"save",color:"primary",type:"submit",disable:f.canCreate()},{default:(0,o.w5)((()=>[(0,o.Uk)(" 保存 ")])),_:1},8,["disable"]),(0,o.Wm)(r,{flat:"",dense:"",icon:"refresh",color:"primary",type:"reset"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1},8,["onSubmit","onReset"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{columns:p.columns,rows:l.value,pagination:p.pagination.value,"onUpdate:pagination":a[13]||(a[13]=e=>p.pagination.value=e),onRequest:p.onRequest,"row-key":"id",loading:p.loading.value,"binary-state-sort":"",separator:"cell","rows-per-page-options":[7,10,15],"visible-columns":["nickname","avatar","description","url","created_at","updated_at","operation"]},{"body-cell-avatar":(0,o.w5)((e=>[(0,o.Wm)(k,{props:e},{default:(0,o.w5)((()=>[(0,o._)("img",{src:`${e.row.avatar}`,style:{width:"50px",height:"50px","border-radius":"50%"},alt:"图片加载失败"},null,8,s)])),_:2},1032,["props"])])),"body-cell-url":(0,o.w5)((e=>[(0,o.Wm)(k,{props:e},{default:(0,o.w5)((()=>[(0,o._)("a",{href:e.row.url,target:"_blank"},(0,n.zw)(e.row.url),9,m)])),_:2},1032,["props"])])),"body-cell-operation":(0,o.w5)((e=>[(0,o.Wm)(k,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{dense:"",round:"",icon:"edit",color:"primary",class:"q-mx-sm",onClick:a=>v.open(e.row)},null,8,["onClick"]),(0,o.Wm)(r,{dense:"",round:"",icon:"delete",class:"q-mx-sm",color:"negative",onClick:a=>g(e.row.id)},null,8,["onClick"])])),_:2},1032,["props"])])),"bottom-row":(0,o.w5)((()=>[(0,o.Wm)(h,{onClick:a[12]||(a[12]=e=>f.open()),class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{colspan:"100",class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(V,{name:"add"}),(0,o.Uk)(" 添加 ")])),_:1})])),_:1})])),_:1},8,["columns","rows","pagination","onRequest","loading"])])),_:1})],64)}}};var d=l(128),p=l(6786),f=l(7392),v=l(7537),g=l(9033),b=l(8545),w=l(1789),y=l(5779),k=l(5541),V=l(1236),h=l(9658),_=l(1909),W=l(9332),C=l.n(W);const U=c,q=U;C()(c,"components",{QDialog:d.Z,QCard:p.Z,QCardSection:f.Z,QForm:v.Z,QInput:g.Z,QFile:b.Z,QCardActions:w.Z,QBtn:y.Z,QTable:k.Z,QTd:V.Z,QTr:h.Z,QIcon:_.Z})}}]);