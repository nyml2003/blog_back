"use strict";(globalThis["webpackChunkventus"]=globalThis["webpackChunkventus"]||[]).push([[7480],{7480:(e,l,a)=>{a.r(l),a.d(l,{default:()=>S});var o=a(6929),t=a(80),n=a(1944),i=a(7218),r=a(9482);const u=["src"],s=["src"],m=["href"],c={__name:"FriendManage",setup(e){const l=(0,n.Z)(),a=(0,i.iH)([]),c=(0,i.iH)(!1),d=()=>{c.value=!0,r.userApi.get("/friend/rest/",{params:{page:p.pagination.value.page,page_size:p.pagination.value.rowsPerPage}}).then((e=>{a.value=e.data.results,a.value.forEach((e=>{e.homepage=e.url,b(e.url).then((l=>{e.homepage=l}))})),c.value=!1,p.pagination.value.rowsNumber=e.data.count}))},p={loading:(0,i.iH)(!1),columns:[{name:"id",label:"ID",field:"id",align:"center"},{name:"nickname",label:"昵称",field:"nickname",align:"center"},{name:"avatar",label:"头像",field:"avatar",align:"center"},{name:"description",label:"个人简介",field:"description",align:"center",format:e=>e.length>10?e.substring(0,10)+"...":e},{name:"url",label:"个人主页",field:"url",align:"center"},{name:"created_at",label:"创建时间",field:"created_at",format:e=>new Date(e).toLocaleString(),align:"center"},{name:"updated_at",label:"更新时间",field:"updated_at",format:e=>new Date(e).toLocaleString(),align:"center"},{name:"operation",label:"操作",field:"operation",align:"center"}],pagination:(0,i.iH)({sortBy:"id",descending:!1,page:1,rowsNumber:0,rowsPerPage:7}),onRequest:function(e){const{page:l,rowsPerPage:a}=e.pagination;p.pagination.value.page=l,p.pagination.value.rowsPerPage=a,d()}},f={canCreate:function(){return JSON.stringify(f.form.value)===JSON.stringify(f.nullForm)},nullForm:{nickname:"",avatar:null,description:"",url:""},form:(0,i.iH)({nickname:"",avatar:null,description:"",url:""}),isVisible:(0,i.iH)(!1),reset:function(){f.form.value=JSON.parse(JSON.stringify(f.nullForm))},submit:function(){r.userApi.post("/friend/rest/",f.form.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{l.notify({message:"添加成功",color:"positive",icon:"check",position:"top",timeout:1e3}),f.reset(),f.close(),d()})).catch((e=>{console.log(e),f.reset(),f.close()}))},open:function(){this.isVisible.value=!0},close:function(){this.isVisible.value=!1}},g={isImgChange:(0,i.iH)(!1),canUpdate:function(){return JSON.stringify(g.form.value)===JSON.stringify(g.formCopy.value)},avatar:(0,i.iH)(null),formCopy:(0,i.iH)({id:"",nickname:"",avatar:null,description:"",url:""}),form:(0,i.iH)({id:"",nickname:"",avatar:null,description:"",url:""}),isVisible:(0,i.iH)(!1),reset:function(){g.form.value=JSON.parse(JSON.stringify(g.formCopy.value))},submit:function(){r.userApi.patch(`/friend/rest/${g.form.value.id}/`,g.form.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{l.notify({message:"修改成功",color:"positive",icon:"check",position:"top",timeout:1e3}),g.reset(),g.close(),d()})).catch((e=>{console.log(e),g.reset(),g.close()}))},open:function(e){this.isVisible.value=!0;const{id:l,nickname:a,avatar:o,description:t,url:n}=e;g.avatar.value=o,g.form.value={id:l,nickname:a,avatar:null,description:t,url:n},g.formCopy.value=JSON.parse(JSON.stringify(g.form.value))},close:function(){this.isVisible.value=!1}};function v(e){l.notify({message:"删除中",color:"warning",textColor:"black",icon:"warning",position:"center",actions:[{label:"取消",color:"black",handler:()=>{l.notify({message:"取消删除",color:"negative",icon:"close",position:"top",timeout:1e3})}},{label:"确定",color:"red",handler:()=>{w(e)}}]})}function w(e){r.userApi.delete(`/friend/rest/${e}/`).then((e=>{l.notify({message:"删除成功",color:"positive",icon:"check",position:"top",timeout:1e3}),d()})).catch((e=>{console.log(e)}))}async function b(e){const l=await fetch(e),a=await l.text(),o=new DOMParser,t=o.parseFromString(a,"text/html");return t.querySelector("title").textContent}return(0,o.bv)((()=>{d()})),(e,l)=>{const n=(0,o.up)("q-input"),i=(0,o.up)("q-file"),r=(0,o.up)("q-btn"),c=(0,o.up)("q-card-actions"),d=(0,o.up)("q-form"),w=(0,o.up)("q-card-section"),b=(0,o.up)("q-card"),h=(0,o.up)("q-dialog"),y=(0,o.up)("q-td"),k=(0,o.up)("q-tooltip"),V=(0,o.up)("q-icon"),_=(0,o.up)("q-tr"),W=(0,o.up)("q-table");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(h,{modelValue:g.isVisible.value,"onUpdate:modelValue":l[5]||(l[5]=e=>g.isVisible.value=e),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{onSubmit:g.submit,onReset:g.reset},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{modelValue:g.form.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=e=>g.form.value.nickname=e),label:"昵称","lazy-rules":"",rules:[e=>!!e||"请输入昵称"]},null,8,["modelValue","rules"]),(0,o.Wm)(i,{modelValue:g.form.value.avatar,"onUpdate:modelValue":l[1]||(l[1]=e=>g.form.value.avatar=e),label:"头像","lazy-rules":"",multiple:!1,accept:"image/*"},{prepend:(0,o.w5)((()=>[null===g.form.value.avatar?((0,o.wg)(),(0,o.iD)("img",{key:0,src:`${g.avatar.value}`,style:{width:"50px",height:"50px","border-radius":"50%"},alt:"图片加载失败"},null,8,u)):(0,o.kq)("",!0)])),_:1},8,["modelValue"]),(0,o.Wm)(n,{modelValue:g.form.value.description,"onUpdate:modelValue":l[2]||(l[2]=e=>g.form.value.description=e),label:"个人简介","lazy-rules":""},null,8,["modelValue"]),(0,o.Wm)(n,{modelValue:g.form.value.url,"onUpdate:modelValue":l[3]||(l[3]=e=>g.form.value.url=e),label:"个人主页","lazy-rules":"",rules:[e=>!!e||"请输入个人主页"]},null,8,["modelValue","rules"]),(0,o.Wm)(c,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{flat:"",dense:"",icon:"close",color:"negative",onClick:l[4]||(l[4]=e=>g.close())},{default:(0,o.w5)((()=>[(0,o.Uk)(" 取消 ")])),_:1}),(0,o.Wm)(r,{flat:"",dense:"",icon:"save",color:"primary",type:"submit",disable:g.canUpdate()},{default:(0,o.w5)((()=>[(0,o.Uk)(" 保存 ")])),_:1},8,["disable"]),(0,o.Wm)(r,{flat:"",dense:"",icon:"refresh",color:"primary",type:"reset"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1},8,["onSubmit","onReset"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(h,{modelValue:f.isVisible.value,"onUpdate:modelValue":l[11]||(l[11]=e=>f.isVisible.value=e),persistent:""},{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{onSubmit:f.submit,onReset:f.reset},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{modelValue:f.form.value.nickname,"onUpdate:modelValue":l[6]||(l[6]=e=>f.form.value.nickname=e),label:"昵称","lazy-rules":"",rules:[e=>!!e||"请输入昵称"]},null,8,["modelValue","rules"]),(0,o.Wm)(i,{modelValue:f.form.value.avatar,"onUpdate:modelValue":l[7]||(l[7]=e=>f.form.value.avatar=e),label:"头像","lazy-rules":"",rules:[e=>!!e||"请选择头像"],multiple:!1,accept:"image/*"},null,8,["modelValue","rules"]),(0,o.Wm)(n,{modelValue:f.form.value.description,"onUpdate:modelValue":l[8]||(l[8]=e=>f.form.value.description=e),label:"个人简介","lazy-rules":""},null,8,["modelValue"]),(0,o.Wm)(n,{modelValue:f.form.value.url,"onUpdate:modelValue":l[9]||(l[9]=e=>f.form.value.url=e),label:"个人主页","lazy-rules":"",rules:[e=>!!e||"请输入个人主页"]},null,8,["modelValue","rules"]),(0,o.Wm)(c,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{flat:"",dense:"",icon:"close",color:"negative",onClick:l[10]||(l[10]=e=>f.close())},{default:(0,o.w5)((()=>[(0,o.Uk)(" 取消 ")])),_:1}),(0,o.Wm)(r,{flat:"",dense:"",icon:"save",color:"primary",type:"submit",disable:f.canCreate()},{default:(0,o.w5)((()=>[(0,o.Uk)(" 保存 ")])),_:1},8,["disable"]),(0,o.Wm)(r,{flat:"",dense:"",icon:"refresh",color:"primary",type:"reset"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1},8,["onSubmit","onReset"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(W,{columns:p.columns,rows:a.value,pagination:p.pagination.value,"onUpdate:pagination":l[13]||(l[13]=e=>p.pagination.value=e),onRequest:p.onRequest,"row-key":"id",loading:p.loading.value,"binary-state-sort":"",separator:"cell","rows-per-page-options":[7,10,15],"visible-columns":["nickname","avatar","description","url","created_at","updated_at","operation"]},{"body-cell-avatar":(0,o.w5)((e=>[(0,o.Wm)(y,{props:e},{default:(0,o.w5)((()=>[(0,o._)("img",{src:`${e.row.avatar}`,style:{width:"50px",height:"50px","border-radius":"50%"},alt:"图片加载失败"},null,8,s)])),_:2},1032,["props"])])),"body-cell-url":(0,o.w5)((e=>[(0,o.Wm)(y,{props:e},{default:(0,o.w5)((()=>[(0,o._)("a",{href:e.row.url,target:"_blank"},(0,t.zw)(e.row.homepage),9,m)])),_:2},1032,["props"])])),"body-cell-description":(0,o.w5)((e=>[(0,o.Wm)(y,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{self:"center middle",anchor:"center middle"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.row.description?e.row.description:"暂无个人简介"),1)])),_:2},1024),(0,o.Uk)(" "+(0,t.zw)(e.row.description.length>10?e.row.description.substring(0,10)+"...":e.row.description),1)])),_:2},1032,["props"])])),"body-cell-operation":(0,o.w5)((e=>[(0,o.Wm)(y,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{dense:"",round:"",icon:"edit",color:"primary",class:"q-mx-sm",onClick:l=>g.open(e.row)},null,8,["onClick"]),(0,o.Wm)(r,{dense:"",round:"",icon:"delete",class:"q-mx-sm",color:"negative",onClick:l=>v(e.row.id)},null,8,["onClick"])])),_:2},1032,["props"])])),"bottom-row":(0,o.w5)((()=>[(0,o.Wm)(_,{onClick:l[12]||(l[12]=e=>f.open()),class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{colspan:"100",class:"text-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(V,{name:"add"}),(0,o.Uk)(" 添加 ")])),_:1})])),_:1})])),_:1},8,["columns","rows","pagination","onRequest","loading"])])),_:1})],64)}}};var d=a(128),p=a(6786),f=a(7392),g=a(7537),v=a(9033),w=a(8545),b=a(1789),h=a(5779),y=a(5541),k=a(1236),V=a(9558),_=a(9658),W=a(1909),C=a(9332),U=a.n(C);const q=c,S=q;U()(c,"components",{QDialog:d.Z,QCard:p.Z,QCardSection:f.Z,QForm:g.Z,QInput:v.Z,QFile:w.Z,QCardActions:b.Z,QBtn:h.Z,QTable:y.Z,QTd:k.Z,QTooltip:V.Z,QTr:_.Z,QIcon:W.Z})}}]);