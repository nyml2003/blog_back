"use strict";(globalThis["webpackChunkventus"]=globalThis["webpackChunkventus"]||[]).push([[9558],{9658:(e,l,a)=>{a.d(l,{Z:()=>i});var t=a(6929),o=a(859),n=a(8192);const i=(0,o.L)({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:l}){const a=(0,t.Fl)((()=>"q-tr"+(void 0===e.props||!0===e.props.header?"":" "+e.props.__trClass)+(!0===e.noHover?" q-tr--no-hover":"")));return()=>(0,t.h)("tr",{class:a.value},(0,n.KR)(l.default))}})},9558:(e,l,a)=>{a.r(l),a.d(l,{default:()=>A});var t=a(6929),o=a(80),n=a(1944),i=a(7218),r=a(9482);const s=["src"],u=["src"],c=["href"],d={__name:"FriendManage",setup(e){const l=(0,n.Z)(),a=(0,i.iH)([]),d=(0,i.iH)(!1),m=()=>{d.value=!0,r.userApi.get("/friend/rest/",{params:{page:p.pagination.value.page,page_size:p.pagination.value.rowsPerPage}}).then((e=>{a.value=e.data.results,a.value.forEach((e=>{e.homepage=e.url,b(e.url).then((l=>{e.homepage=l}))})),d.value=!1,p.pagination.value.rowsNumber=e.data.count}))},p={loading:(0,i.iH)(!1),columns:[{name:"id",label:"ID",field:"id",align:"center"},{name:"nickname",label:"昵称",field:"nickname",align:"center"},{name:"avatar",label:"头像",field:"avatar",align:"center"},{name:"description",label:"个人简介",field:"description",align:"center",format:e=>e.length>10?e.substring(0,10)+"...":e},{name:"url",label:"个人主页",field:"url",align:"center"},{name:"created_at",label:"创建时间",field:"created_at",format:e=>new Date(e).toLocaleString(),align:"center"},{name:"updated_at",label:"更新时间",field:"updated_at",format:e=>new Date(e).toLocaleString(),align:"center"},{name:"operation",label:"操作",field:"operation",align:"center"}],pagination:(0,i.iH)({sortBy:"id",descending:!1,page:1,rowsNumber:0,rowsPerPage:7}),onRequest:function(e){const{page:l,rowsPerPage:a}=e.pagination;p.pagination.value.page=l,p.pagination.value.rowsPerPage=a,m()}},f={canCreate:function(){return JSON.stringify(f.form.value)===JSON.stringify(f.nullForm)},nullForm:{nickname:"",avatar:null,description:"",url:""},form:(0,i.iH)({nickname:"",avatar:null,description:"",url:""}),isVisible:(0,i.iH)(!1),reset:function(){f.form.value=JSON.parse(JSON.stringify(f.nullForm))},submit:function(){r.userApi.post("/friend/rest/",f.form.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{l.notify({message:"添加成功",color:"positive",icon:"check",position:"top",timeout:1e3}),f.reset(),f.close(),m()})).catch((e=>{console.log(e),f.reset(),f.close()}))},open:function(){this.isVisible.value=!0},close:function(){this.isVisible.value=!1}},v={isImgChange:(0,i.iH)(!1),canUpdate:function(){return JSON.stringify(v.form.value)===JSON.stringify(v.formCopy.value)},avatar:(0,i.iH)(null),formCopy:(0,i.iH)({id:"",nickname:"",avatar:null,description:"",url:""}),form:(0,i.iH)({id:"",nickname:"",avatar:null,description:"",url:""}),isVisible:(0,i.iH)(!1),reset:function(){v.form.value=JSON.parse(JSON.stringify(v.formCopy.value))},submit:function(){r.userApi.patch(`/friend/rest/${v.form.value.id}/`,v.form.value,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{l.notify({message:"修改成功",color:"positive",icon:"check",position:"top",timeout:1e3}),v.reset(),v.close(),m()})).catch((e=>{console.log(e),v.reset(),v.close()}))},open:function(e){this.isVisible.value=!0;const{id:l,nickname:a,avatar:t,description:o,url:n}=e;v.avatar.value=t,v.form.value={id:l,nickname:a,avatar:null,description:o,url:n},v.formCopy.value=JSON.parse(JSON.stringify(v.form.value))},close:function(){this.isVisible.value=!1}};function g(e){l.notify({message:"删除中",color:"warning",textColor:"black",icon:"warning",position:"center",actions:[{label:"取消",color:"black",handler:()=>{l.notify({message:"取消删除",color:"negative",icon:"close",position:"top",timeout:1e3})}},{label:"确定",color:"red",handler:()=>{h(e)}}]})}function h(e){r.userApi.delete(`/friend/rest/${e}/`).then((e=>{l.notify({message:"删除成功",color:"positive",icon:"check",position:"top",timeout:1e3}),m()})).catch((e=>{console.log(e)}))}async function b(e){const l=await fetch(e),a=await l.text(),t=new DOMParser,o=t.parseFromString(a,"text/html");return o.querySelector("title").textContent}return(0,t.bv)((()=>{m()})),(e,l)=>{const n=(0,t.up)("q-input"),i=(0,t.up)("q-file"),r=(0,t.up)("q-btn"),d=(0,t.up)("q-card-actions"),m=(0,t.up)("q-form"),h=(0,t.up)("q-card-section"),b=(0,t.up)("q-card"),w=(0,t.up)("q-dialog"),y=(0,t.up)("q-td"),k=(0,t.up)("q-tooltip"),_=(0,t.up)("q-icon"),V=(0,t.up)("q-tr"),W=(0,t.up)("q-table");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(w,{modelValue:v.isVisible.value,"onUpdate:modelValue":l[5]||(l[5]=e=>v.isVisible.value=e),persistent:""},{default:(0,t.w5)((()=>[(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{onSubmit:v.submit,onReset:v.reset},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{modelValue:v.form.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=e=>v.form.value.nickname=e),label:"昵称","lazy-rules":"",rules:[e=>!!e||"请输入昵称"]},null,8,["modelValue","rules"]),(0,t.Wm)(i,{modelValue:v.form.value.avatar,"onUpdate:modelValue":l[1]||(l[1]=e=>v.form.value.avatar=e),label:"头像","lazy-rules":"",multiple:!1,accept:"image/*"},{prepend:(0,t.w5)((()=>[null===v.form.value.avatar?((0,t.wg)(),(0,t.iD)("img",{key:0,src:`${v.avatar.value}`,style:{width:"50px",height:"50px","border-radius":"50%"},alt:"图片加载失败"},null,8,s)):(0,t.kq)("",!0)])),_:1},8,["modelValue"]),(0,t.Wm)(n,{modelValue:v.form.value.description,"onUpdate:modelValue":l[2]||(l[2]=e=>v.form.value.description=e),label:"个人简介","lazy-rules":""},null,8,["modelValue"]),(0,t.Wm)(n,{modelValue:v.form.value.url,"onUpdate:modelValue":l[3]||(l[3]=e=>v.form.value.url=e),label:"个人主页","lazy-rules":"",rules:[e=>!!e||"请输入个人主页"]},null,8,["modelValue","rules"]),(0,t.Wm)(d,{align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{flat:"",dense:"",icon:"close",color:"negative",onClick:l[4]||(l[4]=e=>v.close())},{default:(0,t.w5)((()=>[(0,t.Uk)(" 取消 ")])),_:1}),(0,t.Wm)(r,{flat:"",dense:"",icon:"save",color:"primary",type:"submit",disable:v.canUpdate()},{default:(0,t.w5)((()=>[(0,t.Uk)(" 保存 ")])),_:1},8,["disable"]),(0,t.Wm)(r,{flat:"",dense:"",icon:"refresh",color:"primary",type:"reset"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1},8,["onSubmit","onReset"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(w,{modelValue:f.isVisible.value,"onUpdate:modelValue":l[11]||(l[11]=e=>f.isVisible.value=e),persistent:""},{default:(0,t.w5)((()=>[(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,{onSubmit:f.submit,onReset:f.reset},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{modelValue:f.form.value.nickname,"onUpdate:modelValue":l[6]||(l[6]=e=>f.form.value.nickname=e),label:"昵称","lazy-rules":"",rules:[e=>!!e||"请输入昵称"]},null,8,["modelValue","rules"]),(0,t.Wm)(i,{modelValue:f.form.value.avatar,"onUpdate:modelValue":l[7]||(l[7]=e=>f.form.value.avatar=e),label:"头像","lazy-rules":"",rules:[e=>!!e||"请选择头像"],multiple:!1,accept:"image/*"},null,8,["modelValue","rules"]),(0,t.Wm)(n,{modelValue:f.form.value.description,"onUpdate:modelValue":l[8]||(l[8]=e=>f.form.value.description=e),label:"个人简介","lazy-rules":""},null,8,["modelValue"]),(0,t.Wm)(n,{modelValue:f.form.value.url,"onUpdate:modelValue":l[9]||(l[9]=e=>f.form.value.url=e),label:"个人主页","lazy-rules":"",rules:[e=>!!e||"请输入个人主页"]},null,8,["modelValue","rules"]),(0,t.Wm)(d,{align:"right"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{flat:"",dense:"",icon:"close",color:"negative",onClick:l[10]||(l[10]=e=>f.close())},{default:(0,t.w5)((()=>[(0,t.Uk)(" 取消 ")])),_:1}),(0,t.Wm)(r,{flat:"",dense:"",icon:"save",color:"primary",type:"submit",disable:f.canCreate()},{default:(0,t.w5)((()=>[(0,t.Uk)(" 保存 ")])),_:1},8,["disable"]),(0,t.Wm)(r,{flat:"",dense:"",icon:"refresh",color:"primary",type:"reset"},{default:(0,t.w5)((()=>[(0,t.Uk)(" 重置 ")])),_:1})])),_:1})])),_:1},8,["onSubmit","onReset"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(W,{columns:p.columns,rows:a.value,pagination:p.pagination.value,"onUpdate:pagination":l[13]||(l[13]=e=>p.pagination.value=e),onRequest:p.onRequest,"row-key":"id",loading:p.loading.value,"binary-state-sort":"",separator:"cell","rows-per-page-options":[7,10,15],"visible-columns":["nickname","avatar","description","url","created_at","updated_at","operation"]},{"body-cell-avatar":(0,t.w5)((e=>[(0,t.Wm)(y,{props:e},{default:(0,t.w5)((()=>[(0,t._)("img",{src:`${e.row.avatar}`,style:{width:"50px",height:"50px","border-radius":"50%"},alt:"图片加载失败"},null,8,u)])),_:2},1032,["props"])])),"body-cell-url":(0,t.w5)((e=>[(0,t.Wm)(y,{props:e},{default:(0,t.w5)((()=>[(0,t._)("a",{href:e.row.url,target:"_blank"},(0,o.zw)(e.row.homepage),9,c)])),_:2},1032,["props"])])),"body-cell-description":(0,t.w5)((e=>[(0,t.Wm)(y,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{self:"center middle",anchor:"center middle"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.row.description?e.row.description:"暂无个人简介"),1)])),_:2},1024),(0,t.Uk)(" "+(0,o.zw)(e.row.description.length>10?e.row.description.substring(0,10)+"...":e.row.description),1)])),_:2},1032,["props"])])),"body-cell-operation":(0,t.w5)((e=>[(0,t.Wm)(y,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{dense:"",round:"",icon:"edit",color:"primary",class:"q-mx-sm",onClick:l=>v.open(e.row)},null,8,["onClick"]),(0,t.Wm)(r,{dense:"",round:"",icon:"delete",class:"q-mx-sm",color:"negative",onClick:l=>g(e.row.id)},null,8,["onClick"])])),_:2},1032,["props"])])),"bottom-row":(0,t.w5)((()=>[(0,t.Wm)(V,{onClick:l[12]||(l[12]=e=>f.open()),class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{colspan:"100",class:"text-center"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{name:"add"}),(0,t.Uk)(" 添加 ")])),_:1})])),_:1})])),_:1},8,["columns","rows","pagination","onRequest","loading"])])),_:1})],64)}}};var m=a(128),p=a(6786),f=a(7392),v=a(7537),g=a(9033),h=a(8545),b=a(1789),w=a(5779),y=a(5541),k=a(1236),_=a(8689),V=a(1979),W=a(1316),S=a(3852),q=a(4833),C=a(1683),H=a(7933),T=a(9345),U=a(859),Z=a(8679),O=a(4290),x=a(4187),P=a(8192),N=a(7337),D=a(358);const Q=(0,U.L)({name:"QTooltip",inheritAttrs:!1,props:{...V.u,...S.vr,...C.D,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:D.$},self:{type:String,default:"top middle",validator:D.$},offset:{type:Array,default:()=>[14,14],validator:D.io},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...S.gH],setup(e,{slots:l,emit:a,attrs:o}){let n,r;const s=(0,t.FN)(),{proxy:{$q:u}}=s,c=(0,i.iH)(null),d=(0,i.iH)(!1),m=(0,t.Fl)((()=>(0,D.li)(e.anchor,u.lang.rtl))),p=(0,t.Fl)((()=>(0,D.li)(e.self,u.lang.rtl))),f=(0,t.Fl)((()=>!0!==e.persistent)),{registerTick:v,removeTick:g}=(0,H.Z)(),{registerTimeout:h}=(0,T.Z)(),{transitionProps:b,transitionStyle:w}=(0,C.Z)(e),{localScrollTarget:y,changeScrollEvent:k,unconfigureScrollTarget:U}=(0,W.Z)(e,G),{anchorEl:Q,canShow:F,anchorEvents:z}=(0,V.Z)({showing:d,configureAnchorEl:K}),{show:J,hide:R}=(0,S.ZP)({showing:d,canShow:F,handleShow:M,handleHide:$,hideOnRouteChange:f,processOnMount:!0});Object.assign(z,{delayShow:B,delayHide:Y});const{showPortal:E,hidePortal:A,renderPortal:L}=(0,q.Z)(s,c,ee,"tooltip");if(!0===u.platform.is.mobile){const l={anchorEl:Q,innerRef:c,onClickOutside(e){return R(e),e.target.classList.contains("q-dialog__backdrop")&&(0,O.NS)(e),!0}},a=(0,t.Fl)((()=>null===e.modelValue&&!0!==e.persistent&&!0===d.value));(0,t.YP)(a,(e=>{const a=!0===e?N.m:N.D;a(l)})),(0,t.Jd)((()=>{(0,N.D)(l)}))}function M(l){E(),v((()=>{r=new MutationObserver((()=>I())),r.observe(c.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),I(),G()})),void 0===n&&(n=(0,t.YP)((()=>u.screen.width+"|"+u.screen.height+"|"+e.self+"|"+e.anchor+"|"+u.lang.rtl),I)),h((()=>{E(!0),a("show",l)}),e.transitionDuration)}function $(l){g(),A(),j(),h((()=>{A(!0),a("hide",l)}),e.transitionDuration)}function j(){void 0!==r&&(r.disconnect(),r=void 0),void 0!==n&&(n(),n=void 0),U(),(0,O.ul)(z,"tooltipTemp")}function I(){(0,D.wq)({targetEl:c.value,offset:e.offset,anchorEl:Q.value,anchorOrigin:m.value,selfOrigin:p.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function B(l){if(!0===u.platform.is.mobile){(0,x.M)(),document.body.classList.add("non-selectable");const e=Q.value,l=["touchmove","touchcancel","touchend","click"].map((l=>[e,l,"delayHide","passiveCapture"]));(0,O.M0)(z,"tooltipTemp",l)}h((()=>{J(l)}),e.delay)}function Y(l){!0===u.platform.is.mobile&&((0,O.ul)(z,"tooltipTemp"),(0,x.M)(),setTimeout((()=>{document.body.classList.remove("non-selectable")}),10)),h((()=>{R(l)}),e.hideDelay)}function K(){if(!0===e.noParentEvent||null===Q.value)return;const l=!0===u.platform.is.mobile?[[Q.value,"touchstart","delayShow","passive"]]:[[Q.value,"mouseenter","delayShow","passive"],[Q.value,"mouseleave","delayHide","passive"]];(0,O.M0)(z,"anchor",l)}function G(){if(null!==Q.value||void 0!==e.scrollTarget){y.value=(0,Z.b0)(Q.value,e.scrollTarget);const l=!0===e.noParentEvent?I:R;k(y.value,l)}}function X(){return!0===d.value?(0,t.h)("div",{...o,ref:c,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",o.class],style:[o.style,w.value],role:"tooltip"},(0,P.KR)(l.default)):null}function ee(){return(0,t.h)(_.uT,b.value,X)}return(0,t.Jd)(j),Object.assign(s.proxy,{updatePosition:I}),L}});var F=a(9658),z=a(1909),J=a(9332),R=a.n(J);const E=d,A=E;R()(d,"components",{QDialog:m.Z,QCard:p.Z,QCardSection:f.Z,QForm:v.Z,QInput:g.Z,QFile:h.Z,QCardActions:b.Z,QBtn:w.Z,QTable:y.Z,QTd:k.Z,QTooltip:Q,QTr:F.Z,QIcon:z.Z})}}]);